<section class="container-big">
  @if (!loadingBook) {
  <div class="flex gap-10">
    <div class="max-w-96 flex-shrink-0">
      <div class="max-h-[500px] h-full">
        <img
          [src]="
            mainCover
              ? (mainCover | bookImage : 'L' : 'id')
              : '/assets/if there is no image.png'
          "
          alt="main cover"
          class="w-full h-full object-cover"
        />
      </div>
      <div class="my-5">
        <p *ngIf="book.first_publish_date" class="mb-2">
          First published in
          <span class="font-semibold">{{ book.first_publish_date }}</span>
        </p>
        <p *ngIf="bookExternalData.number_of_pages_median" class="mb-2">
          Pages:
          <span class="font-semibold">{{
            bookExternalData.number_of_pages_median
          }}</span>
        </p>
        <p *ngIf="book.created">
          Release date:
          <span class="font-semibold">{{
            book.created.value | date : "longDate"
          }}</span>
        </p>
      </div>
      <div class="mb-3" *ngIf="book.links">
        <h3 class="text-2xl font-semibold">Links</h3>
        <ul class="list-disc pl-5">
          @for (link of book.links; track $index) {
          <li
            class="mb-2 underline text-blue-700 transition-colors hover:text-blue-800"
          >
            <a [href]="link.url">{{ link.title }}</a>
          </li>
          }
        </ul>
      </div>
    </div>
    <div class="max-w-full w-full">
      <h1 class="font-semibold text-5xl mb-5">
        {{ book.title | truncateText : 100 }}
      </h1>
      <div class="mb-5" *ngIf="book.description; else noDescription">
        <h3 class="text-2xl font-semibold pb-2">Description</h3>
        <p>
          {{
            book.description.value || book.description.toString()
              | truncateText : descriptionShowLength : isDescriptionFullText
          }}
          <span class="ml-1"
            ><button
              type="button"
              (click)="showCloseDescription()"
              class="underline text-blue-700 transition-colors hover:text-blue-800"
            >
              {{ descriptionBtn }}
            </button></span
          >
        </p>
      </div>
      <ng-template #noDescription
        ><p class="my-5">This book has no description</p></ng-template
      >
      <div class="flex justify-between pb-10">
        <div class="mb-3 max-w-[30%] w-full">
          <app-item-scroll-list
            [itemObj]="charactersListObject"
            [listTitle]="'Main Characters'"
          ></app-item-scroll-list>
        </div>
        <div class="mb-3 max-w-[30%] w-full">
          <app-item-scroll-list
            [itemObj]="placesListObject"
            [listTitle]="'Main Places'"
          ></app-item-scroll-list>
        </div>
        <div class="mb-3 max-w-[30%] w-full">
          <app-item-scroll-list
            [itemObj]="subjectsListObject"
            [listTitle]="'Main Subjects'"
          ></app-item-scroll-list>
        </div>
      </div>
      @if (!loadingAuthor) {
      <div class="mb-3">
        <h3 class="text-2xl font-semibold pb-2">Authors</h3>
        @for (author of authors; track $index) {
        <app-bookitem-author
          [author]="author"
          [authorKeys]="authorKeys"
          [index]="$index"
        ></app-bookitem-author>
        }
      </div>
      } @else {
      <p class="text-3xl font-semibold">Loading authors...</p>
      }
    </div>
  </div>
  <div class="flex justify-between items-start py-10">
    <app-bookitem-ratings
      [ratingData]="bookExternalData"
    ></app-bookitem-ratings>
    <div class="max-w-full w-full mx-5">
      <app-bookitem-comments-section
        [bookId]="bookId"
        [neededUserInfo]="neededUserInfo"
      ></app-bookitem-comments-section>
    </div>
    <div class="w-60">
      <h3 class="text-2xl font-semibold pb-2 text-center">Bookmark</h3>
      <p class="mb-5 text-center">
        {{ isBookmarked ? "Bookmarked" : "Not bookmarked" }}
      </p>
      <app-bookmark-button
        [isBookmarked]="isBookmarked"
        (bookmarkedChange)="getBookmarkedChange($event)"
        class="text-center max-w-full w-full block"
      ></app-bookmark-button>
    </div>
  </div>
  } @else {
  <p class="text-3xl font-semibold">Loading...</p>
  }
</section>
